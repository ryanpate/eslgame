<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Signup - VocabLab</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <nav>
                <a href="index.html" class="logo">
                    <span class="emoji">üß™</span>
                    <span>VocabLab</span>
                </a>
                <div class="nav-links">
                    <a href="index.html">üè† Home</a>
                    <a href="teacher-login.html">Login</a>
                </div>
            </nav>
        </header>

        <main>
            <div class="auth-container">
                <div class="auth-card">
                    <div class="auth-header">
                        <h1>üë®‚Äçüè´ Create Teacher Account</h1>
                        <p>Join VocabLab and start managing your classes</p>
                    </div>

                    <form id="signup-form" class="auth-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName">First Name</label>
                                <input type="text" id="firstName" name="firstName" required
                                       placeholder="John">
                            </div>
                            <div class="form-group">
                                <label for="lastName">Last Name</label>
                                <input type="text" id="lastName" name="lastName" required
                                       placeholder="Smith">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" name="email" required
                                   placeholder="teacher@school.com" autocomplete="email">
                        </div>

                        <div class="form-group">
                            <label for="school">School/Organization</label>
                            <input type="text" id="school" name="school" required
                                   placeholder="Lincoln High School">
                        </div>

                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" name="password" required
                                   placeholder="At least 8 characters" autocomplete="new-password"
                                   minlength="8">
                            <small>Must be at least 8 characters long</small>
                        </div>

                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <input type="password" id="confirmPassword" name="confirmPassword" required
                                   placeholder="Re-enter your password" autocomplete="new-password">
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="terms" name="terms" required>
                                <span>I agree to the <a href="#" target="_blank">Terms of Service</a> and <a href="#" target="_blank">Privacy Policy</a></span>
                            </label>
                        </div>

                        <div id="error-message" class="error-message hidden"></div>
                        <div id="success-message" class="success-message hidden"></div>

                        <button type="submit" class="btn btn-primary btn-large" id="signup-btn">
                            Create Account
                        </button>
                    </form>

                    <div class="auth-footer">
                        <p>Already have an account? <a href="teacher-login.html">Log in here</a></p>
                    </div>
                </div>

                <div class="features-sidebar">
                    <h3>‚ú® What You Get</h3>
                    <ul class="feature-list">
                        <li>üÜì <strong>Free Forever</strong> - No credit card needed</li>
                        <li>üë• Manage up to 30 students per class</li>
                        <li>üìä Real-time progress tracking</li>
                        <li>üéØ 3 vocabulary themes</li>
                        <li>üéÆ 6 interactive games</li>
                        <li>üìà Detailed reports & analytics</li>
                        <li>üì± Works on all devices</li>
                        <li>üíæ Automatic data backup</li>
                    </ul>

                    <div class="testimonial">
                        <p>"VocabLab has transformed my ESL classroom! My students are more engaged than ever."</p>
                        <small>- Sarah M., ESL Teacher</small>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>üß™ VocabLab - Learn English with Fun!</p>
            <p class="small">Interactive ESL Vocabulary Games</p>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>

    <script>
        // Initialize Firebase
        if (typeof firebaseConfig !== 'undefined' && firebaseConfig.apiKey !== 'YOUR_API_KEY') {
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();

            // Check if already logged in
            auth.onAuthStateChanged((user) => {
                if (user) {
                    window.location.href = 'teacher-dashboard.html';
                }
            });

            // Handle form submission
            document.getElementById('signup-form').addEventListener('submit', async (e) => {
                e.preventDefault();

                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();
                const email = document.getElementById('email').value.trim();
                const school = document.getElementById('school').value.trim();
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                const signupBtn = document.getElementById('signup-btn');
                const errorMessage = document.getElementById('error-message');
                const successMessage = document.getElementById('success-message');

                // Hide messages
                errorMessage.classList.add('hidden');
                successMessage.classList.add('hidden');

                // Validate passwords match
                if (password !== confirmPassword) {
                    errorMessage.textContent = 'Passwords do not match.';
                    errorMessage.classList.remove('hidden');
                    return;
                }

                // Validate password length
                if (password.length < 8) {
                    errorMessage.textContent = 'Password must be at least 8 characters long.';
                    errorMessage.classList.remove('hidden');
                    return;
                }

                // Disable button and show loading
                signupBtn.disabled = true;
                signupBtn.textContent = 'Creating Account...';

                try {
                    // Create user account
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;

                    // Update display name
                    await user.updateProfile({
                        displayName: `${firstName} ${lastName}`
                    });

                    // Create teacher document in Firestore
                    await db.collection('teachers').doc(user.uid).set({
                        firstName: firstName,
                        lastName: lastName,
                        email: email,
                        school: school,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        classIds: [],
                        accountType: 'free', // 'free' or 'premium'
                        totalStudents: 0
                    });

                    // Show success message
                    successMessage.textContent = 'Account created successfully! Redirecting to dashboard...';
                    successMessage.classList.remove('hidden');

                    // Redirect to dashboard
                    setTimeout(() => {
                        window.location.href = 'teacher-dashboard.html';
                    }, 2000);

                } catch (error) {
                    console.error('Signup error:', error);

                    // Show error message
                    errorMessage.classList.remove('hidden');

                    switch (error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage.textContent = 'An account with this email already exists.';
                            break;
                        case 'auth/invalid-email':
                            errorMessage.textContent = 'Invalid email address.';
                            break;
                        case 'auth/operation-not-allowed':
                            errorMessage.textContent = 'Email/password accounts are not enabled.';
                            break;
                        case 'auth/weak-password':
                            errorMessage.textContent = 'Password is too weak. Please use a stronger password.';
                            break;
                        default:
                            errorMessage.textContent = error.message || 'Signup failed. Please try again.';
                    }

                    // Re-enable button
                    signupBtn.disabled = false;
                    signupBtn.textContent = 'Create Account';
                }
            });

        } else {
            // Firebase not configured
            document.getElementById('signup-form').innerHTML = `
                <div class="warning-message">
                    <h3>‚ö†Ô∏è Firebase Not Configured</h3>
                    <p>Please set up your Firebase project and update the firebase-config.js file.</p>
                    <p>See the setup instructions in firebase-config.js</p>
                </div>
            `;
        }
    </script>
</body>
</html>
